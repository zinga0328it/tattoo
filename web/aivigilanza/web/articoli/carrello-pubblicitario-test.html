<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <!-- Cache bust v4 -->
  <title data-i18n="carrello-title">üöö Carrello Elettronico Sicuro - ServicesS.net</title>
  <style>
    :root {
      --bg: #0b1320;
      --card: #111a2b;
      --text: #e8f0ff;
      --muted: #94a3b8;
      --brand: #4da3ff;
      --ok: #1ee37d;
      --error: #ff4757;
      --warning: #ffa500;
    }
    * { box-sizing: border-box; }
    body {
      background: var(--bg);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      min-height: 100vh;
      line-height: 1.6;
    }
    .flag-bar {
      display: flex;
      gap: 8px;
      justify-content: flex-end;
      padding: 10px 18px 0 0;
      user-select: none;
    }
    .flag {
      width: 32px;
      height: 24px;
      border-radius: 4px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      border: 1px solid rgba(255,255,255,.1);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      background: rgba(255,255,255,.05);
      overflow: hidden;
    }
    .flag:hover { 
      transform: scale(1.1); 
      box-shadow: 0 4px 12px rgba(0,0,0,.3);
    }
    .flag.active { 
      border-color: var(--brand);
      box-shadow: 0 0 8px rgba(77, 163, 255, 0.4);
    }
    .wrap {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin: 40px 0;
    }
    .card {
      background: var(--card);
      border: 1px solid rgba(255,255,255,.08);
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 4px 16px rgba(0,0,0,.2);
    }
    .card h2 {
      margin: 0 0 16px;
      color: var(--text);
      font-size: 1.5em;
    }
    .card h3 {
      margin: 20px 0 12px;
      color: var(--brand);
      font-size: 1.2em;
    }
    .card ul {
      margin: 0;
      padding-left: 20px;
    }
    .card li {
      margin: 8px 0;
      color: var(--muted);
    }
    .btn {
      display: inline-block;
      padding: 12px 24px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.16);
      background: var(--brand);
      color: #fff;
      font-weight: 600;
      text-decoration: none;
      margin-top: 18px;
      box-shadow: 0 4px 16px rgba(77,163,255,.3);
      transition: all 0.2s;
      font-size: 1.1em;
    }
    .btn:hover {
      background: var(--ok);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(30,194,139,.4);
    }
    .btn-demo {
      background: var(--warning);
      box-shadow: 0 4px 16px rgba(255,165,0,.3);
    }
    .btn-demo:hover {
      background: #ff8c00;
      box-shadow: 0 6px 20px rgba(255,140,0,.4);
    }
    .pricing-table {
      display: grid;
      gap: 16px;
    }
    .pricing-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 16px;
      background: rgba(255,255,255,.03);
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,.05);
    }
    .pricing-item .price {
      font-weight: bold;
      color: var(--ok);
      font-size: 1.2em;
    }
    .steps {
      counter-reset: step-counter;
    }
    .step {
      counter-increment: step-counter;
      display: flex;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 20px;
      padding: 16px;
      background: rgba(255,255,255,.03);
      border-radius: 8px;
      border: 1px solid rgba(255,255,255,.05);
    }
    .step::before {
      content: counter(step-counter);
      background: var(--brand);
      color: #fff;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      flex-shrink: 0;
    }
    .security-badge {
      display: inline-block;
      background: linear-gradient(135deg, var(--brand), var(--ok));
      color: #fff;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: bold;
      margin: 8px 8px 0 0;
      box-shadow: 0 2px 8px rgba(77,163,255,.3);
    }
    footer {
      padding: 30px 20px;
      text-align: center;
      color: var(--muted);
      border-top: 1px solid rgba(255,255,255,.08);
      margin-top: 60px;
    }
    .hero {
      text-align: center;
      margin: 40px 0;
      padding: 40px;
      background: linear-gradient(135deg, rgba(77,163,255,.1), rgba(30,227,125,.1));
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.1);
    }
    .hero h1 {
      font-size: 3em;
      margin: 0 0 20px;
      background: linear-gradient(135deg, var(--brand), var(--ok));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .hero p {
      font-size: 1.3em;
      color: var(--muted);
      margin: 0;
    }
    @media (max-width: 700px) {
      .wrap { padding: 18px 4vw; }
      .card { padding: 16px; }
      .grid { grid-template-columns: 1fr; }
      .hero h1 { font-size: 2em; }
      .hero { padding: 20px; }
    }
  </style>
</head>
<body>
  <!-- Flag Bar -->
  <div class="flag-bar">
    <div id="flag-en" class="flag flag-en active" onclick="cambiaLingua('en')" title="English">
      <svg width="24" height="18" viewBox="0 0 24 18" xmlns="http://www.w3.org/2000/svg">
        <rect width="24" height="9" fill="#012169"/>
        <rect y="9" width="24" height="9" fill="#012169"/>
        <rect width="24" height="18" fill="white"/>
        <rect width="2" height="18" x="11" fill="white"/>
        <rect width="24" height="2" y="8" fill="white"/>
        <rect width="2" height="18" x="10" fill="#C8102E"/>
        <rect width="24" height="2" y="7" fill="#C8102E"/>
        <rect width="24" height="2" y="9" fill="#C8102E"/>
        <rect width="2" height="18" x="12" fill="#C8102E"/>
      </svg>
    </div>
    <div id="flag-ru" class="flag flag-ru" onclick="cambiaLingua('ru')" title="–†—É—Å—Å–∫–∏–π">
      <svg width="24" height="18" viewBox="0 0 24 18" xmlns="http://www.w3.org/2000/svg">
        <rect width="24" height="6" fill="white"/>
        <rect y="6" width="24" height="6" fill="#0052B4"/>
        <rect y="12" width="24" height="6" fill="#D52B1E"/>
      </svg>
    </div>
    <div id="flag-he" class="flag flag-he" onclick="cambiaLingua('he')" title="◊¢◊ë◊®◊ô◊™">
      <svg width="24" height="18" viewBox="0 0 24 18" xmlns="http://www.w3.org/2000/svg">
        <rect width="24" height="18" fill="#FFFFFF"/>
        <rect width="8" height="18" x="8" fill="#005EB8"/>
        <polygon points="8,0 8,18 16,9" fill="#005EB8"/>
        <polygon points="16,0 16,18 8,9" fill="#005EB8"/>
        <path d="M 10.5 4.5 L 11.5 4.5 L 11.5 6.5 L 10.5 6.5 Z M 12.5 4.5 L 13.5 4.5 L 13.5 6.5 L 12.5 6.5 Z" fill="#F6C700"/>
        <path d="M 10.5 11.5 L 11.5 11.5 L 11.5 13.5 L 10.5 13.5 Z M 12.5 11.5 L 13.5 11.5 L 13.5 13.5 L 12.5 13.5 Z" fill="#F6C700"/>
      </svg>
    </div>
    <div id="flag-ar" class="flag flag-ar" onclick="cambiaLingua('ar')" title="ÿßŸÑÿπÿ±ÿ®Ÿäÿ©">
      <svg width="24" height="18" viewBox="0 0 24 18" xmlns="http://www.w3.org/2000/svg">
        <rect width="24" height="6" fill="#CE1126"/>
        <rect y="6" width="24" height="6" fill="white"/>
        <rect y="12" width="24" height="6" fill="#006C35"/>
        <path d="M 12 9 L 10 7 L 10 11 Z" fill="#141414"/>
      </svg>
    </div>
    <div id="flag-zh" class="flag flag-zh" onclick="cambiaLingua('zh')" title="‰∏≠Êñá">
      <svg width="24" height="18" viewBox="0 0 24 18" xmlns="http://www.w3.org/2000/svg">
        <rect width="24" height="18" fill="#DE2910"/>
        <polygon points="0,0 9,9 0,18" fill="#FFDE00"/>
        <polygon points="3,7.5 4.5,9 3,10.5 1.5,9" fill="#FFDE00"/>
        <polygon points="6,6 7.5,7.5 6,9 4.5,7.5" fill="#FFDE00"/>
        <polygon points="6,10.5 7.5,9 6,7.5 4.5,9" fill="#FFDE00"/>
      </svg>
    </div>
    <div id="flag-it" class="flag flag-it" onclick="cambiaLingua('it')" title="Italiano">
      <svg width="24" height="18" viewBox="0 0 24 18" xmlns="http://www.w3.org/2000/svg">
        <rect width="8" height="18" fill="#009246"/>
        <rect x="8" width="8" height="18" fill="white"/>
        <rect x="16" width="8" height="18" fill="#CE2B37"/>
      </svg>
    </div>
  </div>

  <!-- Main Content -->
  <div class="wrap">
    <!-- Navigation Menu -->
    <div style="text-align: center; margin: 20px 0 40px 0;">
      <select id="pageSelect" onchange="navigateToPage(this.value)" style="background: var(--card); color: var(--text); border: 1px solid rgba(255,255,255,.2); border-radius: 8px; padding: 10px 15px; font-size: 1em; cursor: pointer; min-width: 200px;">
        <option value="">Seleziona pagina...</option>
        <option value="index.html">üè† Home</option>
        <option value="SafeNode.html">üîí SafeNode‚Ñ¢</option>
        <option value="antivirus.html">üõ°Ô∏è Antivirus</option>
        <option value="bonifiche.html">üßπ Bonifiche</option>
        <option value="straordinarie.html">üßΩ Pulizie Straordinarie</option>
        <option value="guardiania.html">üëÆ Guardiania</option>
        <option value="domotica.html">üè† Domotica</option>
        <option value="sistemista.html">üíª Sistemista</option>
        <option value="yggdrasil.html">üåê Yggdrasil</option>
        <option value="chisiamo.html">‚ÑπÔ∏è Chi Siamo</option>
        <option value="contatti.html">üìû Contatti</option>
        <option value="shop/carrello.html">üõí Carrello Elettronico</option>
      </select>
    </div>

    <!-- Hero Section -->
    <div class="hero">
      <h1 data-i18n="carrello-hero-title">üöö Carrello Elettronico Sicuro</h1>
      <p data-i18n="carrello-hero-subtitle">Sistema innovativo di consegne basato su SafeNode‚Ñ¢ - Sicurezza massima, velocit√† garantita</p>
      <div style="margin-top: 20px;">
        <span class="security-badge" data-i18n="carrello-badge-1">üîí SafeNode‚Ñ¢ Protetto</span>
        <span class="security-badge" data-i18n="carrello-badge-2">üåê Yggdrasil Network</span>
        <span class="security-badge" data-i18n="carrello-badge-3">üì± SMS Automatici</span>
        <span class="security-badge" data-i18n="carrello-badge-4">‚ö° Consegna 45min</span>
      </div>
    </div>

    <!-- Come Funziona -->
    <div class="card">
      <h2 data-i18n="carrello-come-funziona">üì± Come Funziona il Carrello Elettronico</h2>
      <div class="steps">
        <div class="step">
          <div data-i18n="carrello-step-1"><strong>Cliente ordina online:</strong> Seleziona prodotti dal menu digitale, inserisce indirizzo e numero telefono</div>
        </div>
        <div class="step">
          <div data-i18n="carrello-step-2"><strong>Riceve conferma immediata:</strong> SMS automatico con codice di conferma per validare l'ordine</div>
        </div>
        <div class="step">
          <div data-i18n="carrello-step-3"><strong>Consegna garantita:</strong> Il rider consegna entro 45 minuti dall'ordine confermato</div>
        </div>
        <div class="step">
          <div data-i18n="carrello-step-4"><strong>Sicurezza totale:</strong> Tutto protetto da SafeNode‚Ñ¢ e rete Yggdrasil crittografata</div>
        </div>
      </div>
    </div>

    <!-- Vantaggi -->
    <div class="grid">
      <div class="card">
        <h2>üîí Sicurezza Avanzata</h2>
        <ul>
          <li data-i18n="carrello-sicurezza-1"><strong>SafeNode‚Ñ¢ Base:</strong> Hardware blindato, Linux ottimizzato, firewall nftables</li>
          <li data-i18n="carrello-sicurezza-2"><strong>Yggdrasil Network:</strong> Doppia protezione con rete crittografata end-to-end</li>
          <li data-i18n="carrello-sicurezza-3"><strong>Dati Protetti:</strong> Nessun salvataggio di carte di credito, solo telefono e indirizzo</li>
          <li data-i18n="carrello-sicurezza-4"><strong>Connessione Sicura:</strong> IP fisso dedicato, SIM Business TIM</li>
        </ul>
      </div>

      <div class="card">
        <h2 data-i18n="carrello-velocita-title">‚ö° Velocit√† e Affidabilit√†</h2>
        <ul>
          <li data-i18n="carrello-velocita-1"><strong>Consegna 45 minuti:</strong> Garantita per tutto il territorio servito</li>
          <li data-i18n="carrello-velocita-2"><strong>24/7 Disponibile:</strong> Sistema sempre attivo, riavvio automatico</li>
          <li data-i18n="carrello-velocita-3"><strong>Notifiche Real-time:</strong> SMS e Telegram per ogni ordine</li>
          <li data-i18n="carrello-velocita-4"><strong>Tracking Ordini:</strong> Controllo stato ordine via codice</li>
        </ul>
      </div>

      <div class="card">
        <h2 data-i18n="carrello-innovazione-title">üéØ Innovazione Unica</h2>
        <ul>
          <li data-i18n="carrello-innovazione-1"><strong>Senza Email/Telegram:</strong> Solo numero telefono per privacy massima</li>
          <li data-i18n="carrello-innovazione-2"><strong>Conferma SMS:</strong> Sistema antifrode con codice di validazione</li>
          <li data-i18n="carrello-innovazione-3"><strong>Menu Dinamico:</strong> Prodotti aggiornati in tempo reale</li>
          <li data-i18n="carrello-innovazione-4"><strong>Multi-categoria:</strong> Cibo, bevande, dolci, combustibili</li>
        </ul>
      </div>
    </div>

    <!-- Demo Interattiva -->
    <div class="card" style="text-align: center;">
      <h2 data-i18n="carrello-demo-title">üéÆ Prova il Sistema Demo</h2>
      <p data-i18n="carrello-demo-text" style="color: var(--muted); margin-bottom: 20px;">
        Scopri come funziona il carrello elettronico con la nostra demo interattiva.<br>
        Aggiungi prodotti, simula un ordine e vedi le notifiche in tempo reale!
      </p>
      <a href="shop/carrello.html" class="btn btn-demo" target="_blank" data-i18n="carrello-demo-btn">
        üöÄ Prova Carrello Demo
      </a>
    </div>

    <!-- Prezzi -->
    <div class="card">
      <h2 data-i18n="carrello-prezzi-title">üí∞ Prezzi Carrello Elettronico</h2>
      <div class="pricing-table">
        <div class="pricing-item">
          <span data-i18n="carrello-prezzo-1">Setup Sistema Completo (SafeNode‚Ñ¢ + Software)</span>
          <span class="price">499‚Ç¨ una tantum</span>
        </div>
        <div class="pricing-item">
          <span data-i18n="carrello-prezzo-2">Manutenzione Mensile (aggiornamenti + supporto)</span>
          <span class="price">29‚Ç¨/mese</span>
        </div>
        <div class="pricing-item">
          <span data-i18n="carrello-prezzo-3">SIM TIM Business con IP fisso</span>
          <span class="price">35‚Ç¨/mese</span>
        </div>
        <div class="pricing-item">
          <span data-i18n="carrello-prezzo-4">SMS Twilio (per conferme ordini)</span>
          <span class="price">0.05‚Ç¨/SMS</span>
        </div>
      </div>
      <p data-i18n="carrello-prezzi-note" style="color: var(--muted); font-size: 0.9em; margin-top: 16px;">
        * Prezzi IVA esclusa. Setup include configurazione SafeNode‚Ñ¢, installazione software carrello,
        integrazione Yggdrasil e test completo del sistema.
      </p>
    </div>

    <!-- Sicurezza -->
    <div class="card">
      <h2 data-i18n="carrello-doppia-sicurezza">üõ°Ô∏è Sistema di Sicurezza a Doppio Livello</h2>
      <h3 data-i18n="carrello-safenode-title">SafeNode‚Ñ¢ Hardware</h3>
      <ul>
        <li data-i18n="carrello-safenode-1">Black box blindata, progettata per funzionare 24/7</li>
        <li data-i18n="carrello-safenode-2">Linux ottimizzato con firewall nftables avanzato</li>
        <li data-i18n="carrello-safenode-3">IP fisso dedicato con SIM TIM Business</li>
        <li data-i18n="carrello-safenode-4">Protezione fisica e digitale integrata</li>
      </ul>

      <h3 data-i18n="carrello-yggdrasil-title">Yggdrasil Network</h3>
      <ul>
        <li data-i18n="carrello-yggdrasil-1">Rete crittografata end-to-end globale</li>
        <li data-i18n="carrello-yggdrasil-2">Nessun server centrale, architettura distribuita</li>
        <li data-i18n="carrello-yggdrasil-3">IPv6 nativo con crittografia post-quantistica</li>
        <li data-i18n="carrello-yggdrasil-4">Protezione aggiuntiva contro intercettazioni</li>
      </ul>
    </div>

    <!-- CTA Finale -->
    <div class="card" style="text-align: center;">
      <h2 data-i18n="carrello-cta-title">üöÄ Pronto a Digitalizzare le Tue Consegne?</h2>
      <p data-i18n="carrello-cta-text">Sistema sicuro, affidabile e innovativo basato sulla nostra tecnologia SafeNode‚Ñ¢</p>
      <a href="../contatti.html" class="btn" data-i18n="carrello-cta-btn-1">Contattaci per il Carrello</a>
      <a href="shop/carrello.html" class="btn btn-demo" style="margin-left: 16px;" data-i18n="carrello-cta-btn-2">Prova Demo</a>
    </div>
  </div>

  <footer>
    <p data-i18n="carrello-footer">&copy; 2025 AiVigilanza - Sistema Carrello Elettronico Sicuro</p>
  </footer>

  <script src="traduzioni/traduzioni-carrello.js?v=20251223-2"></script>
  <script>
    // Funzione per cambiare lingua
    function cambiaLingua(lang) {
      // Rimuovi classe active da tutte le flag
      document.querySelectorAll('.flag').forEach(f => f.classList.remove('active'));
      // Aggiungi classe active alla flag selezionata
      document.getElementById('flag-' + lang).classList.add('active');
      // Salva la lingua nel localStorage
      localStorage.setItem('lang', lang);

      // Applica le traduzioni
      applicaTraduzioni(lang);
    }

    // Funzione per applicare le traduzioni
    function applicaTraduzioni(lang) {
      console.log('=== INIZIO TRADUZIONI ===');
      console.log('Lingua richiesta:', lang);
      console.log('window.traduzioniCarrello disponibile?', typeof window.traduzioniCarrello);

      if (typeof window.traduzioniCarrello === 'undefined') {
        console.error('ERRORE: window.traduzioniCarrello non √® definito!');
        return;
      }

      // Se la lingua richiesta non √® presente, tenta un reload con cache-bust una sola volta
      if (!window.traduzioniCarrello[lang]) {
        console.warn('Traduzioni non trovate per lingua:', lang, '- tentativo di ricaricare con cache-bust');
        if (!window._trTradReloadAttempted) {
          window._trTradReloadAttempted = true;
          var s = document.createElement('script');
          s.src = 'traduzioni/traduzioni-carrello.js?v=' + Date.now();
          s.onload = function() {
            console.log('traduzioni-carrello.js ricaricato, lingue disponibili:', Object.keys(window.traduzioniCarrello || {}));
            // riprova ad applicare le traduzioni richieste
            if (typeof applicaTraduzioni === 'function') applicaTraduzioni(lang);
          };
          s.onerror = function() {
            console.error('Impossibile ricaricare le traduzioni dal server');
            // fallback a English se disponibile
            var fb = window.traduzioniCarrello['en'] || Object.values(window.traduzioniCarrello)[0] || {};
            applyTranslationsObjectToDOM(fb);
          };
          document.head.appendChild(s);
          return; // aspetta che il file sia ricaricato
        } else {
          console.warn('Ricarica gi√† tentata, uso fallback English');
          // continua con fallback
        }
      }

      let traduzioni = window.traduzioniCarrello[lang];
      if (!traduzioni) {
        console.warn('Traduzioni non trovate per lingua:', lang, '- uso fallback su English');
        const fallback = window.traduzioniCarrello['en'] || Object.values(window.traduzioniCarrello)[0];
        traduzioni = fallback || {};
        console.log('Lingue disponibili:', Object.keys(window.traduzioniCarrello));
      }

      // Se la lingua esiste ma mancano alcune chiavi, prova a ricaricare una volta o integra con l'inglese
      try {
        const htmlKeys = Array.from(document.querySelectorAll('[data-i18n]')).map(e => e.getAttribute('data-i18n'));
        const missing = htmlKeys.filter(k => !Object.prototype.hasOwnProperty.call(traduzioni, k));
        if (missing.length) {
          console.warn('Mancano', missing.length, 'chiavi nella lingua', lang);
          // Auto-open panel log per mostrare i dettagli all'utente
          try { showDebug(); } catch(e) { console.warn('showDebug non disponibile'); }

          // Prima cosa: integra immediatamente le chiavi mancanti dall'English per evitare elementi "MANCANTE" nell'UI
          const en = window.traduzioniCarrello['en'] || {};
          missing.forEach(k => {
            if (en && en[k]) {
              traduzioni[k] = en[k];
              console.log('‚Üí temporaneamente sostituito', k, 'da en');
            } else {
              traduzioni[k] = '';
              console.log('‚Üí impostato vuoto per', k);
            }
          });

          // Applica subito le traduzioni aggiornate per rimuovere messaggi di errore dalla console e UI
          try { applyTranslationsObjectToDOM(traduzioni); } catch(e){console.warn('Impossibile applicare temporaneamente le traduzioni:',e)}

          // Poi, in background, tentiamo un reload cache-busted (una sola volta) per ottenere traduzioni aggiornate dal server
          if (!window._trTradKeyReloadAttempted) {
            window._trTradKeyReloadAttempted = true;
            console.log('Tentativo background di ricarica traduzioni dal server (cache-bust).');
            fetch('traduzioni/traduzioni-carrello.js?v=' + Date.now(), {cache: 'reload'})
              .then(resp => { if (!resp.ok) throw new Error('HTTP '+resp.status); return resp.text(); })
              .then(js => {
                try {
                  // Esegui lo script reimpostando window.traduzioniCarrello
                  // Usare Function per valutazione controllata
                  const fn = new Function(js + '\nreturn window.traduzioniCarrello;');
                  fn.call(window);
                  console.log('Ricarico traduzioni completato, lingue disponibili:', Object.keys(window.traduzioniCarrello || {}));

                  // Riprova ad usare le traduzioni aggiornate per la lingua richiesta
                  traduzioni = window.traduzioniCarrello[lang] || traduzioni;
                  const stillMissing = htmlKeys.filter(k => !Object.prototype.hasOwnProperty.call(traduzioni, k));
                  if (stillMissing.length) {
                    console.warn('Dopo ricarica ancora mancano', stillMissing.length, 'chiavi - integro da en');
                    const en2 = window.traduzioniCarrello['en'] || {};
                    stillMissing.forEach(k => {
                      if (en2 && en2[k]) {
                        traduzioni[k] = en2[k];
                        console.log('‚Üí sostituito', k, 'da en (post-reload)');
                      } else {
                        traduzioni[k] = '';
                      }
                    });
                  }

                  applyTranslationsObjectToDOM(traduzioni);
                } catch (e) {
                  console.error('Errore durante l\'applicazione delle traduzioni ricaricate:', e);
                }
              })
              .catch(err => {
                console.error('Impossibile ricaricare traduzioni (fetch):', err);
              });
          } else {
            console.warn('Ricarica gi√† tentata, non riprovo. Uso fallback temporaneo gi√† applicato.');
          }
        }
      } catch (e) {
        console.error('Errore durante l\'integrazione delle chiavi mancanti:', e);
      }

      console.log('Numero di traduzioni trovate:', Object.keys(traduzioni).length);

      // Helper: applica direttamente un oggetto traduzioni alla DOM
      // Usa fallback per singola chiave su English quando la chiave non √® definita o √® vuota
      function applyTranslationsObjectToDOM(t) {
        const elementiConI18n = document.querySelectorAll('[data-i18n]');
        const en = (window.traduzioniCarrello && window.traduzioniCarrello['en']) ? window.traduzioniCarrello['en'] : {};
        elementiConI18n.forEach((element, index) => {
          const key = element.getAttribute('data-i18n');
          let val;
          if (Object.prototype.hasOwnProperty.call(t, key) && t[key] !== undefined && t[key] !== null && t[key] !== '') {
            val = t[key];
          } else if (en && en[key] !== undefined && en[key] !== null && en[key] !== '') {
            val = en[key];
            console.log('‚Üí Fallback per [' + key + '] da en');
          } else {
            val = '';
          }

          if (element.tagName === 'TITLE') {
            if (val) document.title = val;
          } else if (element.tagName === 'META' && element.getAttribute('name') === 'description') {
            if (val) element.setAttribute('content', val);
          } else {
            if (val) element.innerHTML = val;
            else element.innerHTML = '';
          }

          if (val) console.log('‚úì [' + (index+1) + '] ' + key + ': OK');
          else console.warn('‚úó [' + (index+1) + '] ' + key + ': MANCANTE');
        });
      }

      // Applica le traduzioni (con fallback per singole chiavi se necessario)
      console.log('Elementi con data-i18n trovati:', document.querySelectorAll('[data-i18n]').length);
      applyTranslationsObjectToDOM(traduzioni);

      console.log('=== FINE TRADUZIONI ===');
    }

    // Funzione per navigare alle pagine
    function navigateToPage(page) {
      if (page) {
        window.location.href = page;
      }
    }

    // inizializzazione: imposta lingua iniziale
    var lang = localStorage.getItem('lang') || navigator.language.split('-')[0] || 'en';
    if (!['en','ru','he','ar','zh','it'].includes(lang)) lang = 'en';
    cambiaLingua(lang);

    // Debug UI per mostrare i log delle traduzioni (visibile in pagina)
    (function(){
      function createDebugUI(){
        if (document.getElementById('tr-debug-panel')) return;
        // CSS
        const css = document.createElement('style');
        css.id = 'tr-debug-css';
        css.innerHTML = `
#tr-debug-panel{position:fixed;right:12px;bottom:12px;width:420px;max-height:48vh;background:rgba(11,19,32,0.96);color:#e8f0ff;border:1px solid rgba(255,255,255,.06);border-radius:8px;font-family:monospace;font-size:12px;z-index:2147483647;box-shadow:0 8px 30px rgba(0,0,0,.6);overflow:hidden;display:none}
#tr-debug-panel .tr-hdr{display:flex;justify-content:space-between;align-items:center;padding:6px 8px;background:rgba(0,0,0,.2);border-bottom:1px solid rgba(255,255,255,.02)}
#tr-debug-body{padding:8px;overflow:auto;max-height:calc(48vh - 40px)}
.tr-log{padding:4px 6px;border-bottom:1px solid rgba(255,255,255,.03);white-space:pre-wrap}
.tr-log.level-warn{color:#ffb86b}
.tr-log.level-error{color:#ff6b6b}
.tr-btn{background:transparent;border:1px solid rgba(255,255,255,.06);color:#e8f0ff;padding:4px 8px;border-radius:6px;cursor:pointer;margin-left:6px}
.flag.debug-btn{display:inline-flex;align-items:center;justify-content:center}
        `;
        document.head.appendChild(css);

        // Aggiungi bottone toggle alle flag
        const flagBar = document.querySelector('.flag-bar');
        if (flagBar && !document.getElementById('btn-tr-logs')){
          const btn = document.createElement('div');
          btn.id = 'btn-tr-logs';
          btn.className = 'flag debug-btn';
          btn.title = 'Mostra/nascondi log traduzioni (toggle)';
          btn.innerText = 'üìú';
          btn.style.fontSize = '14px';
          btn.onclick = toggleDebug;
          flagBar.appendChild(btn);
        }

        // Pannello log
        const panel = document.createElement('div');
        panel.id = 'tr-debug-panel';
        panel.innerHTML = `
<div class="tr-hdr"><div><strong>Log traduzioni</strong></div><div><button id="tr-log-clear" class="tr-btn">Clear</button><button id="tr-log-close" class="tr-btn">Close</button></div></div>
<div id="tr-debug-body"></div>
`;
        document.body.appendChild(panel);
        panel.querySelector('#tr-log-clear').addEventListener('click', clearDebug);
        panel.querySelector('#tr-log-close').addEventListener('click', ()=>{panel.style.display='none'});
      }

      function appendDebug(level, msg){
        if (!window._tradLogs) window._tradLogs = [];
        const time = (new Date()).toISOString();
        window._tradLogs.push({time, level, msg});
        const body = document.getElementById('tr-debug-body');
        if (body){
          const div = document.createElement('div');
          div.className = 'tr-log level-' + (level || 'log');
          div.textContent = `${time} [${(level||'log').toUpperCase()}] ${msg}`;
          body.appendChild(div);
          // limit entries
          while(body.children.length > 1000) body.removeChild(body.firstChild);
          body.scrollTop = body.scrollHeight;
        }
      }

      window.debugLog = function(level, msg){ appendDebug(level,msg); };
      window.clearDebug = function(){ window._tradLogs = []; const b = document.getElementById('tr-debug-body'); if (b) b.innerHTML = ''; };
      window.toggleDebug = function(){ createDebugUI(); const p = document.getElementById('tr-debug-panel'); p.style.display = (p.style.display === 'block') ? 'none' : 'block'; };
      window.showDebug = function(){ createDebugUI(); document.getElementById('tr-debug-panel').style.display = 'block'; };

      // Monkey-patch console to also output into debug panel
      try{
        ['log','info','warn','error'].forEach(function(l){
          const orig = console[l].bind(console);
          console[l] = function(){
            try{
              const args = Array.from(arguments).map(a=>{
                try{ return (typeof a === 'object') ? JSON.stringify(a) : String(a); }catch(e){ return String(a); }
              }).join(' ');
              appendDebug(l, args);
            }catch(e){}
            orig.apply(console, arguments);
          };
        });
      }catch(e){ /* fail silently */ }

      // Auto-log available languages if loaded
      createDebugUI();
      if (window.traduzioniCarrello) {
        debugLog('info', 'Lingue disponibili: ' + Object.keys(window.traduzioniCarrello).join(', '));
      } else {
        debugLog('warn', 'window.traduzioniCarrello non definito (ancora?)');
      }
    })();
  </script>
</body>
</html>
